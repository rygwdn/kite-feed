# Cursor Rules for Kite Feed Generator

## Code Quality Requirements

Before committing or submitting code, ensure:

1. **Python Syntax Validation**: All Python files must have valid syntax
   - Run: `python3 -m py_compile *.py`
   - Files to check: `process_kite.py`, `generate_rss.py`, `generate_html.py`, `generate_utils.py`

2. **Code Formatting**: Code must be formatted with Black
   - Run: `black --check --diff .`
   - Configuration: `pyproject.toml` (line-length: 127)

3. **Linting**: Code must pass flake8 checks
   - Run: `flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics`
   - Configuration: `.flake8` and `pyproject.toml`

4. **Type Checking**: Type hints should be checked with mypy
   - Run: `mypy --ignore-missing-imports --no-strict-optional --follow-imports=silent *.py`
   - Configuration: `pyproject.toml`

5. **Config Validation**: `config.json` must be valid JSON
   - Run: `python3 -c "import json; json.load(open('config.json'))"`

6. **Script Validation**: All scripts must be importable and executable
   - Ensure all imports resolve correctly
   - Ensure scripts can be run with `python3 script.py`

## Import Dependencies

When adding new imports or dependencies:
- Update `requirements.txt` if adding external packages
- Ensure all imports are used (no unused imports)
- Use type hints where appropriate

## File Structure

- `process_kite.py`: Processes Kagi Kite feeds
- `generate_html.py`: Generates HTML pages
- `generate_rss.py`: Generates RSS feed
- `generate_utils.py`: Shared utilities (date formatting, story processing, etc.)

## Testing Before Commit

Always run the check command before committing:
```bash
# Run all checks at once
./check.sh

# Or using uv directly
uv sync --dev
uv run ./check.sh
```

The `check.sh` script runs all validation checks:
1. Python syntax validation
2. Black formatting check
3. Flake8 critical checks
4. Flake8 all checks (warnings acceptable)
5. Mypy type checking
6. Config validation
7. Import validation

To format code automatically:
```bash
uv run black .
```

## Development Setup

This project uses `uv` for dependency management:

```bash
# Install uv (if not already installed)
curl -LsSf https://astral.sh/uv/install.sh | sh

# Install dependencies (including dev dependencies)
uv sync --dev

# Run scripts
uv run python3 process_kite.py
uv run python3 generate_rss.py
uv run python3 generate_html.py

# Run all checks
./check.sh
```

## CI/CD

The CI workflow (`.github/workflows/ci.yml`) uses `uv` and runs `./check.sh` automatically on:
- Push to `main` branch
- Pull requests to `main` branch

Ensure all CI checks pass before merging.
