<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>{{ config.site.title|e }}</title>
        <link>{{ config.site.base_url }}</link>
        <description>{{ config.site.description|e }}</description>
        <language>en-us</language>
        <lastBuildDate>{{ build_date }}</lastBuildDate>
        <generator>Kite Feed Generator</generator>
        <atom:link href="{{ config.site.base_url }}/feed.xml" rel="self" type="application/rss+xml"/>
        <image>
            <url>https://raw.githubusercontent.com/kagisearch/kite-public/main/static/kite-icon.png</url>
            <title>{{ config.site.title|e }}</title>
            <link>{{ config.site.base_url }}</link>
        </image>
{% for story in stories %}
    {% set story_html_url = story_html_urls[loop.index0] %}
    <item>
        <title>{{ story.title|e }}</title>
        <link>{{ story.url|e if story.url and not story.url.startswith('hash:') else story_html_url|e }}</link>
        <guid isPermaLink="true">{{ story.url|e if story.url and not story.url.startswith('hash:') else story_html_url|e }}</guid>
        <pubDate>{{ story.pub_date }}</pubDate>
        <author>{{ config.site.author|e }}{% if story.category %} ({{ story.category|e }}){% endif %}</author>
        <description><![CDATA[{{ (story.summary or story.title)|process_footnotes(story)|safe }}{% if story.primary_image and story.primary_image.url %}
<div class='image'>
{% if story.primary_image.link %}
<a href="{{ story.primary_image.link|e }}"><img src="{{ story.primary_image.url|e }}" alt="{{ (story.primary_image.caption or story.title)|e }}" style="max-width: 100%; height: auto;" /></a>
{% else %}
<img src="{{ story.primary_image.url|e }}" alt="{{ (story.primary_image.caption or story.title)|e }}" style="max-width: 100%; height: auto;" />
{% endif %}
{% if story.primary_image.caption %}
<p class='caption'>{{ story.primary_image.caption|e }}{% if story.primary_image.credit %} <span class='credit'>({{ story.primary_image.credit|e }})</span>{% endif %}</p>
{% endif %}
</div>
{% endif %}]]></description>
        <content:encoded><![CDATA[{% include 'story_content.html' %}]]></content:encoded>
    </item>
{% endfor %}
    </channel>
</rss>
